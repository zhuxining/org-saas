# PROJECT KNOWLEDGE BASE

**Generated:** 2025-01-20
**Project:** org-sass (Turborepo monorepo)

## OVERVIEW

**Generated:** 2025-01-20
**Project:** org-sass (Turborepo monorepo)
**Status:** Core Implementation Complete (Phase 1-6: 33/33 tasks)
**Latest Update:** Phase 10 (Code Quality) completed - Type issues documented

Fullstack SaaS platform: React web app (TanStack Start), WeChat mini program, docs, with oRPC type-safe backend, Better-Auth, Drizzle + PostgreSQL.

## STRUCTURE

```
org-saas/
├── apps/
│   ├── web/              # TanStack Start + React (SSR)
│   │   └── src/routes/   # File-based routing, see AGENTS.md
│   ├── mini/             # WeChat mini program (TDesign, Skyline)
│   └── fumadocs/         # Documentation site
└── packages/
    ├── api/              # oRPC server, see AGENTS.md
    ├── auth/             # Better-Auth + Admin/Organization plugins
    ├── db/               # Drizzle ORM + schema, see AGENTS.md
    ├── env/              # Shared environment variables
    └── config/           # Shared build config (Biome, TS)
```

### Data Flow

1. **Web Frontend** → oRPC client → `/api/rpc` endpoint
2. **oRPC Server** → Better-Auth session → Drizzle DB queries
3. **Database**: PostgreSQL + Drizzle schema

## WHERE TO LOOK

| Task            | Location                      | Notes                                   |
| --------------- | ----------------------------- | --------------------------------------- |
| Web routing     | apps/web/src/routes/AGENTS.md | File-based routing, -components pattern |
| API endpoints   | packages/api/src/AGENTS.md    | oRPC, isomorphic handlers               |
| Database schema | packages/db/src/AGENTS.md     | Drizzle, migrations                     |
| Auth config     | packages/auth/src/index.ts    | Better-Auth + plugins                   |

## COMMANDS

```bash
bun run dev              # Run all apps (web, mini, docs) in watch mode
bun run dev:web         # Web only (port 3001)
bun run check           # Format and lint all files with Biome (required before commit)

bun run db:push         # Apply schema changes to database
bun run db:studio       # GUI database editor at http://localhost:5555
bun run db:generate     # Generate schema types from SQL
bun run db:migrate      # Create migration files

bun run build           # Build all packages
bun run check-types     # Type check all packages
```

## CONVENTIONS

- **API Routes**: Use `publicProcedure` (no auth) or `protectedProcedure` (requires session)
- **Session Access**: Always check `context.session?.user` in protected procedures
- **Web Routing**: File-based in apps/web/src/routes/, -components/ for route-scoped components
- **Database**: Schemas in packages/db/src/schema/, push changes via `bun run db:push`
- **Imports**: Use workspace paths: `@org-sass/api`, `@org-sass/db`, `@org-sass/auth`
- **Formatter**: Biome (tabs, 2-space indents), pre-commit hook auto-formats

## ANTI-PATTERNS (THIS PROJECT)

- Don't modify `routeTree.gen.ts` - auto-generated by TanStack Router
- Don't modify auto-generated auth tables - Better-Auth manages these
- Don't skip session checks in protected procedures
- Don't mix route groups (admin vs org) - keep separate

## UNIQUE STYLES

- Isomorphic oRPC handlers - same code runs on SSR and client
- Push-based DB migrations - `bun run db:push` updates schema + types
- Route component isolation - each major route domain has its own -components/ folder

## NOTES

- WeChat mini program: apps/mini/, TDesign components, Skyline renderer
- Admin & Organization plugins: configured in packages/auth/src/index.ts
- CORS configured via env.CORS_ORIGIN, update in .env files
